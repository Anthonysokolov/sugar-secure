{"ast":null,"code":"var _jsxFileName = \"/Users/anthony/gh/animal-kingdom/src/SignedIn.js\";\nimport React, { Component } from 'react';\nimport { Switch, Route, Redirect } from 'react-router-dom';\nimport { UserSession } from 'blockstack';\nimport EditMe from './EditMe';\nimport Kingdom from './Kingdom';\nimport NavBar from './NavBar';\nimport OptionsList from './OptionsList';\nimport { appConfig, ME_FILENAME } from './constants';\nimport './SignedIn.css';\n\nclass SignedIn extends Component {\n  constructor(props) {\n    super(props);\n    this.userSession = new UserSession({\n      appConfig\n    });\n    this.state = {\n      me: {},\n      savingMe: false,\n      savingKingdown: false,\n      redirectToMe: false //selectedAnimal: false,\n      //selectedTerritory: false\n\n    };\n    this.loadMe = this.loadMe.bind(this);\n    this.saveMe = this.saveMe.bind(this);\n    this.signOut = this.signOut.bind(this);\n  }\n\n  componentWillMount() {\n    this.loadMe();\n  }\n\n  loadMe() {\n    const options = {\n      decrypt: false\n    };\n    this.userSession.getFile(ME_FILENAME, options).then(content => {\n      const readings = [];\n\n      if (content) {\n        const me = JSON.parse(content);\n        this.setState({\n          me,\n          redirectToMe: false\n        });\n\n        for (var i in me) this.readings.push(me[i]);\n      } else {\n        const me = null;\n        this.setState({\n          me,\n          redirectToMe: true\n        });\n      }\n    });\n  }\n\n  saveMe(me) {\n    this.setState({\n      me,\n      savingMe: true\n    });\n    const options = {\n      encrypt: true\n    };\n    this.userSession.putFile(ME_FILENAME, JSON.stringify(me), options).finally(() => {\n      this.setState({\n        savingMe: false,\n        redirectToMe: false\n      });\n    });\n  }\n\n  signOut(e) {\n    e.preventDefault();\n    this.userSession.signUserOut();\n    window.location = '/';\n  }\n\n  render() {\n    const username = this.userSession.loadUserData().username;\n    const me = this.state.me;\n    const redirectToMe = this.state.redirectToMe;\n\n    if (redirectToMe) {\n      // User hasn't configured their animal\n      if (window.location.pathname !== '/me') {\n        return React.createElement(Redirect, {\n          to: \"/me\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 75\n          },\n          __self: this\n        });\n      }\n    }\n\n    if (window.location.pathname === '/') {\n      return React.createElement(Redirect, {\n        to: \"/kingdom/\".concat(username),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 82\n        },\n        __self: this\n      });\n    }\n\n    return React.createElement(\"div\", {\n      className: \"SignedIn\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 88\n      },\n      __self: this\n    }, React.createElement(NavBar, {\n      username: username,\n      signOut: this.signOut,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 89\n      },\n      __self: this\n    }), React.createElement(Switch, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 90\n      },\n      __self: this\n    }, React.createElement(Route, {\n      path: \"/kingdom/\".concat(username),\n      render: routeProps => React.createElement(Kingdom, Object.assign({\n        myKingdom: true,\n        protocol: window.location.protocol,\n        ruler: username,\n        currentUsername: username,\n        realm: window.location.origin.split('//')[1]\n      }, routeProps, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 94\n        },\n        __self: this\n      })),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 91\n      },\n      __self: this\n    }), \"/*\", React.createElement(Route, {\n      path: \"/kingdom/:protocol/:realm/:ruler\",\n      render: routeProps => React.createElement(Kingdom, Object.assign({\n        myKingdom: false,\n        protocol: routeProps.match.params.protocol,\n        realm: routeProps.match.params.realm,\n        ruler: routeProps.match.params.ruler,\n        currentUsername: username\n      }, routeProps, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 107\n        },\n        __self: this\n      })),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 104\n      },\n      __self: this\n    }), \"*/\"));\n  }\n\n}\n\nexport const readings = this.readings;\nexport default SignedIn;","map":{"version":3,"sources":["/Users/anthony/gh/animal-kingdom/src/SignedIn.js"],"names":["React","Component","Switch","Route","Redirect","UserSession","EditMe","Kingdom","NavBar","OptionsList","appConfig","ME_FILENAME","SignedIn","constructor","props","userSession","state","me","savingMe","savingKingdown","redirectToMe","loadMe","bind","saveMe","signOut","componentWillMount","options","decrypt","getFile","then","content","readings","JSON","parse","setState","i","push","encrypt","putFile","stringify","finally","e","preventDefault","signUserOut","window","location","render","username","loadUserData","pathname","routeProps","protocol","origin","split","match","params","realm","ruler"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport { Switch, Route, Redirect } from 'react-router-dom'\nimport { UserSession } from 'blockstack'\nimport EditMe from './EditMe'\nimport Kingdom from './Kingdom'\nimport NavBar from './NavBar'\nimport OptionsList from './OptionsList'\nimport { appConfig, ME_FILENAME } from './constants'\nimport './SignedIn.css'\n\n\nclass SignedIn extends Component {\n\n  constructor(props) {\n    super(props)\n    this.userSession = new UserSession({ appConfig })\n    this.state = {\n      me: {},\n      savingMe: false,\n      savingKingdown: false,\n      redirectToMe: false\n      //selectedAnimal: false,\n      //selectedTerritory: false\n    }\n\n    this.loadMe = this.loadMe.bind(this)\n    this.saveMe = this.saveMe.bind(this)\n    this.signOut = this.signOut.bind(this)\n  }\n\n  componentWillMount() {\n    this.loadMe()\n  }\n\n  loadMe() {\n    const options = { decrypt: false }\n    this.userSession.getFile(ME_FILENAME, options)\n    .then((content) => {\n      const readings = []\n      if(content) {\n        const me = JSON.parse(content)\n        this.setState({me, redirectToMe: false})\n        for(var i in me)\n          this.readings.push(me[i])\n      } else {\n        const me = null\n        this.setState({me, redirectToMe: true})\n      }\n    })\n  }\n\n  saveMe(me) {\n    this.setState({me, savingMe: true})\n    const options = { encrypt: true }\n    this.userSession.putFile(ME_FILENAME, JSON.stringify(me), options)\n    .finally(() => {\n      this.setState({savingMe: false, redirectToMe: false})\n    })\n  }\n\n  signOut(e) {\n    e.preventDefault()\n    this.userSession.signUserOut()\n    window.location = '/'\n  }\n\n  render() {\n    const username = this.userSession.loadUserData().username\n    const me = this.state.me\n    const redirectToMe = this.state.redirectToMe\n    if(redirectToMe) {\n      // User hasn't configured their animal\n      if(window.location.pathname !== '/me') {\n        return (\n          <Redirect to=\"/me\" />\n        )\n      }\n    }\n\n    if(window.location.pathname === '/') {\n      return (\n        <Redirect to={`/kingdom/${username}`} />\n      )\n    }\n\n\n    return (\n      <div className=\"SignedIn\">\n      <NavBar username={username} signOut={this.signOut}/>\n      <Switch>\n              <Route\n                path={`/kingdom/${username}`}\n                render={\n                  routeProps => <Kingdom\n                  myKingdom={true}\n                  protocol={window.location.protocol}\n                  ruler={username}\n                  currentUsername={username}\n                  realm={window.location.origin.split('//')[1]}\n                  {...routeProps} />\n                }\n              />\n              /*\n              <Route\n                path='/kingdom/:protocol/:realm/:ruler'\n                render={\n                  routeProps => <Kingdom\n                  myKingdom={false}\n                  protocol={routeProps.match.params.protocol}\n                  realm={routeProps.match.params.realm}\n                  ruler={routeProps.match.params.ruler}\n                  currentUsername={username}\n                  {...routeProps} />\n                }\n              />*/\n      </Switch>\n      </div>\n    );\n  }\n}\nexport const readings = this.readings\nexport default SignedIn\n"]},"metadata":{},"sourceType":"module"}