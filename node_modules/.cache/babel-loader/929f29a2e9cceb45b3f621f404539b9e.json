{"ast":null,"code":"var _jsxFileName = \"/Users/anthony/gh/animal-kingdom/src/SignedIn.js\";\nimport React, { Component } from 'react';\nimport { Switch, Route, Redirect } from 'react-router-dom';\nimport { UserSession } from 'blockstack';\nimport Kingdom from './Kingdom';\nimport NavBar from './NavBar';\nimport { appConfig, ME_FILENAME } from './constants';\nimport './SignedIn.css';\nimport Add from \"./add\";\n\nclass SignedIn extends Component {\n  constructor(props) {\n    super(props);\n    this.userSession = new UserSession({\n      appConfig\n    });\n    this.state = {\n      me: {},\n      savingMe: false,\n      savingKingdown: false,\n      redirectToMe: false //selectedAnimal: false,\n      //selectedTerritory: false\n\n    };\n    this.loadMe = this.loadMe.bind(this);\n    this.saveMe = this.saveMe.bind(this);\n    this.signOut = this.signOut.bind(this);\n  }\n\n  componentWillMount() {\n    this.loadMe();\n  }\n\n  loadMe() {\n    let options = {\n      encrypt: true\n    };\n    this.userSession.putFile(ME_FILENAME, JSON.stringify([{\n      y: 90\n    }, {\n      y: 101\n    }, {\n      y: 108\n    }, {\n      y: 98\n    }]), options);\n    let temp = [];\n    options = {\n      decrypt: true\n    };\n    this.userSession.getFile(ME_FILENAME, options).then(async content => {\n      if (content) {\n        temp = await JSON.parse(content);\n        this.setState({\n          readings: temp\n        });\n      }\n    });\n  }\n\n  saveMe(me) {\n    this.setState({\n      me,\n      savingMe: true\n    });\n    const options = {\n      encrypt: true\n    };\n    this.userSession.putFile(ME_FILENAME, JSON.stringify(me), options).finally(() => {\n      this.setState({\n        savingMe: false,\n        redirectToMe: false\n      });\n    });\n  }\n\n  signOut(e) {\n    e.preventDefault();\n    this.userSession.signUserOut();\n    window.location = '/';\n  }\n\n  render() {\n    const username = this.userSession.loadUserData().username; //const me = this.state.me\n\n    const redirectToMe = this.state.redirectToMe;\n\n    if (redirectToMe) {\n      // User hasn't configured their animal\n      if (window.location.pathname !== '/me') {\n        return React.createElement(Redirect, {\n          to: \"/me\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 70\n          },\n          __self: this\n        });\n      }\n    }\n\n    if (window.location.pathname === '/') {\n      return React.createElement(Redirect, {\n        to: \"/kingdom/\".concat(username),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 77\n        },\n        __self: this\n      });\n    }\n\n    return React.createElement(\"div\", {\n      className: \"SignedIn\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 83\n      },\n      __self: this\n    }, React.createElement(NavBar, {\n      username: username,\n      signOut: this.signOut,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 84\n      },\n      __self: this\n    }), React.createElement(Switch, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 85\n      },\n      __self: this\n    }, React.createElement(Route, {\n      path: \"/kingdom/\".concat(username),\n      render: routeProps => React.createElement(Kingdom, Object.assign({\n        myKingdom: true,\n        protocol: window.location.protocol,\n        ruler: username,\n        currentUsername: username,\n        realm: window.location.origin.split('//')[1]\n      }, routeProps, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 89\n        },\n        __self: this\n      })),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 86\n      },\n      __self: this\n    }), React.createElement(Route, {\n      path: \"/add/\",\n      render: routeProps => React.createElement(OtherKingdoms, Object.assign({\n        type: \"territories\"\n      }, routeProps, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 101\n        },\n        __self: this\n      })),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 98\n      },\n      __self: this\n    })));\n  }\n\n}\n\nexport default SignedIn;","map":{"version":3,"sources":["/Users/anthony/gh/animal-kingdom/src/SignedIn.js"],"names":["React","Component","Switch","Route","Redirect","UserSession","Kingdom","NavBar","appConfig","ME_FILENAME","Add","SignedIn","constructor","props","userSession","state","me","savingMe","savingKingdown","redirectToMe","loadMe","bind","saveMe","signOut","componentWillMount","options","encrypt","putFile","JSON","stringify","y","temp","decrypt","getFile","then","content","parse","setState","readings","finally","e","preventDefault","signUserOut","window","location","render","username","loadUserData","pathname","routeProps","protocol","origin","split"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,SAASC,MAAT,EAAiBC,KAAjB,EAAwBC,QAAxB,QAAwC,kBAAxC;AACA,SAASC,WAAT,QAA4B,YAA5B;AACA,OAAOC,OAAP,MAAoB,WAApB;AACA,OAAOC,MAAP,MAAmB,UAAnB;AACA,SAASC,SAAT,EAAoBC,WAApB,QAAuC,aAAvC;AACA,OAAO,gBAAP;AACA,OAAOC,GAAP,MAAgB,OAAhB;;AAEA,MAAMC,QAAN,SAAuBV,SAAvB,CAAiC;AAE/BW,EAAAA,WAAW,CAACC,KAAD,EAAQ;AACjB,UAAMA,KAAN;AACA,SAAKC,WAAL,GAAmB,IAAIT,WAAJ,CAAgB;AAAEG,MAAAA;AAAF,KAAhB,CAAnB;AACA,SAAKO,KAAL,GAAa;AACXC,MAAAA,EAAE,EAAE,EADO;AAEXC,MAAAA,QAAQ,EAAE,KAFC;AAGXC,MAAAA,cAAc,EAAE,KAHL;AAIXC,MAAAA,YAAY,EAAE,KAJH,CAKX;AACA;;AANW,KAAb;AAQA,SAAKC,MAAL,GAAc,KAAKA,MAAL,CAAYC,IAAZ,CAAiB,IAAjB,CAAd;AACA,SAAKC,MAAL,GAAc,KAAKA,MAAL,CAAYD,IAAZ,CAAiB,IAAjB,CAAd;AACA,SAAKE,OAAL,GAAe,KAAKA,OAAL,CAAaF,IAAb,CAAkB,IAAlB,CAAf;AACD;;AAEDG,EAAAA,kBAAkB,GAAG;AACnB,SAAKJ,MAAL;AACD;;AAEDA,EAAAA,MAAM,GAAG;AAEP,QAAIK,OAAO,GAAG;AAAEC,MAAAA,OAAO,EAAE;AAAX,KAAd;AACA,SAAKZ,WAAL,CAAiBa,OAAjB,CAAyBlB,WAAzB,EAAsCmB,IAAI,CAACC,SAAL,CAAe,CAAC;AAACC,MAAAA,CAAC,EAAC;AAAH,KAAD,EAAQ;AAACA,MAAAA,CAAC,EAAC;AAAH,KAAR,EAAgB;AAACA,MAAAA,CAAC,EAAC;AAAH,KAAhB,EAAwB;AAACA,MAAAA,CAAC,EAAC;AAAH,KAAxB,CAAf,CAAtC,EAAuFL,OAAvF;AAEA,QAAIM,IAAI,GAAG,EAAX;AACCN,IAAAA,OAAO,GAAG;AAAEO,MAAAA,OAAO,EAAE;AAAX,KAAV;AACD,SAAKlB,WAAL,CAAiBmB,OAAjB,CAAyBxB,WAAzB,EAAsCgB,OAAtC,EAA+CS,IAA/C,CAAoD,MAAOC,OAAP,IAAkB;AACpE,UAAGA,OAAH,EAAW;AACTJ,QAAAA,IAAI,GAAG,MAAMH,IAAI,CAACQ,KAAL,CAAWD,OAAX,CAAb;AACA,aAAKE,QAAL,CAAc;AAACC,UAAAA,QAAQ,EAACP;AAAV,SAAd;AACD;AACF,KALD;AAMD;;AAEDT,EAAAA,MAAM,CAACN,EAAD,EAAK;AACT,SAAKqB,QAAL,CAAc;AAACrB,MAAAA,EAAD;AAAKC,MAAAA,QAAQ,EAAE;AAAf,KAAd;AACA,UAAMQ,OAAO,GAAG;AAAEC,MAAAA,OAAO,EAAE;AAAX,KAAhB;AACA,SAAKZ,WAAL,CAAiBa,OAAjB,CAAyBlB,WAAzB,EAAsCmB,IAAI,CAACC,SAAL,CAAeb,EAAf,CAAtC,EAA0DS,OAA1D,EACCc,OADD,CACS,MAAM;AACb,WAAKF,QAAL,CAAc;AAACpB,QAAAA,QAAQ,EAAE,KAAX;AAAkBE,QAAAA,YAAY,EAAE;AAAhC,OAAd;AACD,KAHD;AAID;;AAEDI,EAAAA,OAAO,CAACiB,CAAD,EAAI;AACTA,IAAAA,CAAC,CAACC,cAAF;AACA,SAAK3B,WAAL,CAAiB4B,WAAjB;AACAC,IAAAA,MAAM,CAACC,QAAP,GAAkB,GAAlB;AACD;;AAEDC,EAAAA,MAAM,GAAG;AACP,UAAMC,QAAQ,GAAG,KAAKhC,WAAL,CAAiBiC,YAAjB,GAAgCD,QAAjD,CADO,CAEP;;AACA,UAAM3B,YAAY,GAAG,KAAKJ,KAAL,CAAWI,YAAhC;;AACA,QAAGA,YAAH,EAAiB;AACf;AACA,UAAGwB,MAAM,CAACC,QAAP,CAAgBI,QAAhB,KAA6B,KAAhC,EAAuC;AACrC,eACE,oBAAC,QAAD;AAAU,UAAA,EAAE,EAAC,KAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UADF;AAGD;AACF;;AAED,QAAGL,MAAM,CAACC,QAAP,CAAgBI,QAAhB,KAA6B,GAAhC,EAAqC;AACnC,aACE,oBAAC,QAAD;AAAU,QAAA,EAAE,qBAAcF,QAAd,CAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF;AAGD;;AAGD,WACE;AAAK,MAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACA,oBAAC,MAAD;AAAQ,MAAA,QAAQ,EAAEA,QAAlB;AAA4B,MAAA,OAAO,EAAE,KAAKvB,OAA1C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADA,EAEA,oBAAC,MAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACQ,oBAAC,KAAD;AACE,MAAA,IAAI,qBAAcuB,QAAd,CADN;AAEE,MAAA,MAAM,EACJG,UAAU,IAAI,oBAAC,OAAD;AACd,QAAA,SAAS,EAAE,IADG;AAEd,QAAA,QAAQ,EAAEN,MAAM,CAACC,QAAP,CAAgBM,QAFZ;AAGd,QAAA,KAAK,EAAEJ,QAHO;AAId,QAAA,eAAe,EAAEA,QAJH;AAKd,QAAA,KAAK,EAAEH,MAAM,CAACC,QAAP,CAAgBO,MAAhB,CAAuBC,KAAvB,CAA6B,IAA7B,EAAmC,CAAnC;AALO,SAMVH,UANU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAHlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADR,EAaQ,oBAAC,KAAD;AACE,MAAA,IAAI,EAAC,OADP;AAEE,MAAA,MAAM,EACJA,UAAU,IAAI,oBAAC,aAAD;AACd,QAAA,IAAI,EAAC;AADS,SAEVA,UAFU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAHlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAbR,CAFA,CADF;AA2BD;;AAnG8B;;AAqGjC,eAAetC,QAAf","sourcesContent":["import React, { Component } from 'react'\nimport { Switch, Route, Redirect } from 'react-router-dom'\nimport { UserSession } from 'blockstack'\nimport Kingdom from './Kingdom'\nimport NavBar from './NavBar'\nimport { appConfig, ME_FILENAME } from './constants'\nimport './SignedIn.css'\nimport Add from \"./add\"\n\nclass SignedIn extends Component {\n\n  constructor(props) {\n    super(props)\n    this.userSession = new UserSession({ appConfig })\n    this.state = {\n      me: {},\n      savingMe: false,\n      savingKingdown: false,\n      redirectToMe: false\n      //selectedAnimal: false,\n      //selectedTerritory: false\n    }\n    this.loadMe = this.loadMe.bind(this)\n    this.saveMe = this.saveMe.bind(this)\n    this.signOut = this.signOut.bind(this)\n  }\n\n  componentWillMount() {\n    this.loadMe()\n  }\n\n  loadMe() {\n\n    let options = { encrypt: true }\n    this.userSession.putFile(ME_FILENAME, JSON.stringify([{y:90},{y:101},{y:108},{y:98}]), options)\n\n    let temp = []\n     options = { decrypt: true }\n    this.userSession.getFile(ME_FILENAME, options).then(async (content) =>{\n      if(content){\n        temp = await JSON.parse(content)\n        this.setState({readings:temp})\n      }\n    })\n  }\n\n  saveMe(me) {\n    this.setState({me, savingMe: true})\n    const options = { encrypt: true }\n    this.userSession.putFile(ME_FILENAME, JSON.stringify(me), options)\n    .finally(() => {\n      this.setState({savingMe: false, redirectToMe: false})\n    })\n  }\n\n  signOut(e) {\n    e.preventDefault()\n    this.userSession.signUserOut()\n    window.location = '/'\n  }\n\n  render() {\n    const username = this.userSession.loadUserData().username\n    //const me = this.state.me\n    const redirectToMe = this.state.redirectToMe\n    if(redirectToMe) {\n      // User hasn't configured their animal\n      if(window.location.pathname !== '/me') {\n        return (\n          <Redirect to=\"/me\" />\n        )\n      }\n    }\n\n    if(window.location.pathname === '/') {\n      return (\n        <Redirect to={`/kingdom/${username}`} />\n      )\n    }\n\n\n    return (\n      <div className=\"SignedIn\">\n      <NavBar username={username} signOut={this.signOut}/>\n      <Switch>\n              <Route\n                path={`/kingdom/${username}`}\n                render={\n                  routeProps => <Kingdom\n                  myKingdom={true}\n                  protocol={window.location.protocol}\n                  ruler={username}\n                  currentUsername={username}\n                  realm={window.location.origin.split('//')[1]}\n                  {...routeProps} />\n                }\n              />\n              <Route\n                path='/add/'\n                render={\n                  routeProps => <OtherKingdoms\n                  type=\"territories\"\n                  {...routeProps} />\n                }\n              />\n      </Switch>\n      </div>\n    );\n  }\n}\nexport default SignedIn\n"]},"metadata":{},"sourceType":"module"}